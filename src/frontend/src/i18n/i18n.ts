// Lightweight i18n system with EN/ID dictionaries and localStorage persistence

export type Language = 'en' | 'id';

export interface TranslationDictionary {
  [key: string]: string | TranslationDictionary;
}

const STORAGE_KEY = 'sgo_language';

// English translations
const en: TranslationDictionary = {
  common: {
    loading: 'Loading...',
    error: 'Error',
    retry: 'Retry',
    cancel: 'Cancel',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    close: 'Close',
    submit: 'Submit',
    refresh: 'Refresh',
    refreshing: 'Refreshing...',
    all: 'All',
    search: 'Search',
    filter: 'Filter',
    required: 'Required',
  },
  header: {
    guestAccount: 'Guest Account',
    accountStatus: 'Account Status',
    adminPanel: 'Admin Panel',
    login: 'Login',
    logout: 'Logout',
    loggingIn: 'Logging in...',
  },
  footer: {
    builtWith: 'Built with love using',
  },
  guestArea: {
    title: 'Welcome to Sentra Guest OS',
    subtitle: 'Your trusted platform for hotel bookings on the Internet Computer',
    browseHotels: 'Browse Hotels',
    myAccount: 'My Account',
    accountStatus: 'Account Status',
  },
  browse: {
    title: 'Browse Hotels',
    subtitle: 'Discover hotels worldwide on the Sentra Guest OS platform',
    filterHotels: 'Filter Hotels',
    testingMode: 'Testing Mode',
    testingModeDesc: 'Show test hotels for exploring the booking experience',
    searchByCountry: 'Search by Country',
    enterCountry: 'Enter country name...',
    quickSelect: 'Quick Select:',
    allCountries: 'All Countries',
    hotelsFound: 'Hotels Found',
    noHotelsInCountry: 'No hotels found in',
    noHotelsYet: 'No hotels available yet',
    tryDifferent: 'Try searching for a different country or clear the filter.',
    noTestHotels: 'No test hotels are available. Try turning off testing mode to see production hotels.',
    hotelsWillAppear: 'Hotels will appear here once they are activated for public visibility.',
    viewOnMap: 'View on map',
    rooms: 'Rooms',
    bookNow: 'Book Now',
    testingModeUnavailable: 'Testing Mode Unavailable',
    testingModeDisabled: 'Testing mode is currently disabled on the backend. You can only browse and book production hotels. Test hotels will not be visible, and test bookings cannot be created.',
  },
  booking: {
    requestBooking: 'Request Booking at',
    fillDetails: "Fill in your booking details. You'll receive payment instructions after submission.",
    authRequired: 'Authentication Required',
    mustLogin: 'You must be logged in to create a booking request. Please log in and try again.',
    connectionError: 'Connection Error',
    retryConnection: 'Retry Connection',
    bookingFailed: 'Booking Failed',
    checkInDate: 'Check-in Date',
    checkOutDate: 'Check-out Date',
    numberOfGuests: 'Number of Guests',
    roomType: 'Room Type',
    selectRoom: 'Select a room type',
    roomRequired: 'Please select a room type',
    submitRequest: 'Submit Request',
    submitting: 'Submitting...',
    bookingSubmitted: 'Booking Request Submitted',
    bookingId: 'Booking ID',
    myBookings: 'My Bookings',
    bookingStatus: 'Your booking requests and their status',
    noBookingsYet: "You haven't made any booking requests yet.",
    browseAndBook: 'Browse Hotels & Make a Booking',
    checkIn: 'Check-in',
    checkOut: 'Check-out',
    guests: 'Guests',
    requested: 'Requested',
    cancelBooking: 'Are you sure you want to cancel this booking?',
    bookingCancelled: 'Booking cancelled successfully',
    failedToCancel: 'Failed to cancel booking',
    status: {
      pending: 'Pending',
      confirmed: 'Confirmed',
      rejected: 'Rejected',
      cancelled: 'Cancelled',
    },
  },
  payment: {
    paymentInstructions: 'Payment Instructions',
    bookingSubmittedDesc: 'Your booking request has been submitted. Please follow the payment instructions below to complete your booking.',
    manualPayment: 'Manual Payment via Email',
    sendConfirmation: 'Send payment confirmation to our email',
    email: 'Email',
    bookingDetails: 'Booking Details',
    copy: 'Copy',
    copied: 'Copied',
    stepsToComplete: 'Steps to complete payment:',
    step1: 'Make your payment via your preferred method',
    step2: 'Send payment confirmation to',
    step3: 'Include the booking reference in your email',
    step4: 'Wait for hotel confirmation (usually within 24 hours)',
    viewStatus: 'You can view your booking status in your Guest Account page. The hotel will review your request and confirm once payment is verified.',
    hotelInstructions: 'Hotel Payment Instructions',
    hotelInstructionsDesc: 'The hotel has provided the following payment instructions:',
    noInstructions: 'This hotel has not configured payment instructions yet. Please contact the hotel directly or use the email method above.',
  },
  hotel: {
    hotelArea: 'Hotel Area',
    manageHotel: 'Manage your hotel profile, bookings, and guest stays',
    profile: 'Profile',
    rooms: 'Rooms',
    bookings: 'Bookings',
    calendar: 'Calendar',
    recordStay: 'Record Stay',
    subscription: 'Subscription',
    bookingRequests: 'Booking Requests',
    manageRequests: 'Manage incoming booking requests for your hotel',
    noPendingBookings: 'No pending booking requests at the moment.',
    noBookings: 'No booking requests at the moment.',
    confirmBooking: 'Confirm',
    rejectBooking: 'Reject',
    confirming: 'Confirming...',
    rejecting: 'Rejecting...',
    bookingConfirmed: 'Booking confirmed successfully',
    bookingRejected: 'Booking rejected',
    rejectConfirm: 'Are you sure you want to reject this booking?',
    filterByStatus: 'Filter by Status',
    roomInventory: 'Room Inventory',
    manageRooms: "Manage your hotel's room types and pricing",
    addRoom: 'Add Room',
    noRoomsYet: 'No rooms added yet',
    addFirstRoom: 'Start by adding your first room type with photos and pricing',
    addYourFirstRoom: 'Add Your First Room',
    createRoom: 'Create New Room',
    editRoom: 'Edit Room',
    updateRoomDetails: 'Update room details and photos',
    addNewRoom: 'Add a new room type with photos and pricing',
    roomTypeName: 'Room Type / Name',
    roomTypePlaceholder: 'e.g., Deluxe Suite, Standard Room',
    pricePerNight: 'Price per Night',
    currency: 'Currency',
    selectCurrency: 'Select currency',
    enterPrice: 'Enter price',
    promoText: 'Promo Text (Optional)',
    promoPlaceholder: 'e.g., 20% off for early bookings',
    roomPhotos: 'Room Photos',
    uploadImages: 'Upload images (max 2MB each). You can add multiple photos.',
    roomTypeCannotChange: 'Room type cannot be changed when editing',
    createRoomBtn: 'Create Room',
    updateRoomBtn: 'Update Room',
    creating: 'Creating...',
    updating: 'Updating...',
    roomCreated: 'Room created successfully',
    roomUpdated: 'Room updated successfully',
    roomDeleted: 'Room deleted successfully',
    deleteRoomConfirm: 'Are you sure you want to delete the room',
    paymentInstructionsForm: 'Payment Instructions for Guests',
    paymentInstructionsDesc: 'Configure payment instructions that will be shown to guests after they submit a booking request',
    paymentInstructionsPlaceholder: 'Enter payment instructions (bank account, payment methods, etc.)',
    paymentInstructionsSaved: 'Payment instructions saved successfully',
    availability: 'Availability Calendar',
    viewAvailability: 'View booking calendar and room availability',
    filterByRoom: 'Filter by Room Type',
    allRooms: 'All Rooms',
    noBookingsInPeriod: 'No bookings in this period',
    loadingAvailability: 'Loading availability...',
  },
  account: {
    guestAccount: 'Guest Account',
    manageAccount: 'Manage your profile, bookings, and stay history',
    profile: 'Profile',
    bookings: 'Bookings',
    stayHistory: 'Stay History',
  },
  currency: {
    IDR: 'Indonesian Rupiah (IDR)',
    USD: 'US Dollar (USD)',
    EUR: 'Euro (EUR)',
    SGD: 'Singapore Dollar (SGD)',
  },
};

// Indonesian translations
const id: TranslationDictionary = {
  common: {
    loading: 'Memuat...',
    error: 'Kesalahan',
    retry: 'Coba Lagi',
    cancel: 'Batal',
    save: 'Simpan',
    delete: 'Hapus',
    edit: 'Edit',
    close: 'Tutup',
    submit: 'Kirim',
    refresh: 'Segarkan',
    refreshing: 'Menyegarkan...',
    all: 'Semua',
    search: 'Cari',
    filter: 'Filter',
    required: 'Wajib',
  },
  header: {
    guestAccount: 'Akun Tamu',
    accountStatus: 'Status Akun',
    adminPanel: 'Panel Admin',
    login: 'Masuk',
    logout: 'Keluar',
    loggingIn: 'Sedang masuk...',
  },
  footer: {
    builtWith: 'Dibuat dengan cinta menggunakan',
  },
  guestArea: {
    title: 'Selamat Datang di Sentra Guest OS',
    subtitle: 'Platform terpercaya untuk pemesanan hotel di Internet Computer',
    browseHotels: 'Jelajahi Hotel',
    myAccount: 'Akun Saya',
    accountStatus: 'Status Akun',
  },
  browse: {
    title: 'Jelajahi Hotel',
    subtitle: 'Temukan hotel di seluruh dunia di platform Sentra Guest OS',
    filterHotels: 'Filter Hotel',
    testingMode: 'Mode Pengujian',
    testingModeDesc: 'Tampilkan hotel uji coba untuk menjelajahi pengalaman pemesanan',
    searchByCountry: 'Cari berdasarkan Negara',
    enterCountry: 'Masukkan nama negara...',
    quickSelect: 'Pilihan Cepat:',
    allCountries: 'Semua Negara',
    hotelsFound: 'Hotel Ditemukan',
    noHotelsInCountry: 'Tidak ada hotel ditemukan di',
    noHotelsYet: 'Belum ada hotel tersedia',
    tryDifferent: 'Coba cari negara lain atau hapus filter.',
    noTestHotels: 'Tidak ada hotel uji coba tersedia. Coba matikan mode pengujian untuk melihat hotel produksi.',
    hotelsWillAppear: 'Hotel akan muncul di sini setelah diaktifkan untuk visibilitas publik.',
    viewOnMap: 'Lihat di peta',
    rooms: 'Kamar',
    bookNow: 'Pesan Sekarang',
    testingModeUnavailable: 'Mode Pengujian Tidak Tersedia',
    testingModeDisabled: 'Mode pengujian saat ini dinonaktifkan di backend. Anda hanya dapat menjelajahi dan memesan hotel produksi. Hotel uji coba tidak akan terlihat, dan pemesanan uji coba tidak dapat dibuat.',
  },
  booking: {
    requestBooking: 'Minta Pemesanan di',
    fillDetails: 'Isi detail pemesanan Anda. Anda akan menerima instruksi pembayaran setelah pengiriman.',
    authRequired: 'Autentikasi Diperlukan',
    mustLogin: 'Anda harus masuk untuk membuat permintaan pemesanan. Silakan masuk dan coba lagi.',
    connectionError: 'Kesalahan Koneksi',
    retryConnection: 'Coba Koneksi Lagi',
    bookingFailed: 'Pemesanan Gagal',
    checkInDate: 'Tanggal Check-in',
    checkOutDate: 'Tanggal Check-out',
    numberOfGuests: 'Jumlah Tamu',
    roomType: 'Tipe Kamar',
    selectRoom: 'Pilih tipe kamar',
    roomRequired: 'Silakan pilih tipe kamar',
    submitRequest: 'Kirim Permintaan',
    submitting: 'Mengirim...',
    bookingSubmitted: 'Permintaan Pemesanan Dikirim',
    bookingId: 'ID Pemesanan',
    myBookings: 'Pemesanan Saya',
    bookingStatus: 'Permintaan pemesanan Anda dan statusnya',
    noBookingsYet: 'Anda belum membuat permintaan pemesanan.',
    browseAndBook: 'Jelajahi Hotel & Buat Pemesanan',
    checkIn: 'Check-in',
    checkOut: 'Check-out',
    guests: 'Tamu',
    requested: 'Diminta',
    cancelBooking: 'Apakah Anda yakin ingin membatalkan pemesanan ini?',
    bookingCancelled: 'Pemesanan berhasil dibatalkan',
    failedToCancel: 'Gagal membatalkan pemesanan',
    status: {
      pending: 'Menunggu',
      confirmed: 'Dikonfirmasi',
      rejected: 'Ditolak',
      cancelled: 'Dibatalkan',
    },
  },
  payment: {
    paymentInstructions: 'Instruksi Pembayaran',
    bookingSubmittedDesc: 'Permintaan pemesanan Anda telah dikirim. Silakan ikuti instruksi pembayaran di bawah ini untuk menyelesaikan pemesanan Anda.',
    manualPayment: 'Pembayaran Manual via Email',
    sendConfirmation: 'Kirim konfirmasi pembayaran ke email kami',
    email: 'Email',
    bookingDetails: 'Detail Pemesanan',
    copy: 'Salin',
    copied: 'Disalin',
    stepsToComplete: 'Langkah-langkah untuk menyelesaikan pembayaran:',
    step1: 'Lakukan pembayaran melalui metode pilihan Anda',
    step2: 'Kirim konfirmasi pembayaran ke',
    step3: 'Sertakan referensi pemesanan dalam email Anda',
    step4: 'Tunggu konfirmasi hotel (biasanya dalam 24 jam)',
    viewStatus: 'Anda dapat melihat status pemesanan Anda di halaman Akun Tamu. Hotel akan meninjau permintaan Anda dan mengonfirmasi setelah pembayaran diverifikasi.',
    hotelInstructions: 'Instruksi Pembayaran Hotel',
    hotelInstructionsDesc: 'Hotel telah memberikan instruksi pembayaran berikut:',
    noInstructions: 'Hotel ini belum mengonfigurasi instruksi pembayaran. Silakan hubungi hotel secara langsung atau gunakan metode email di atas.',
  },
  hotel: {
    hotelArea: 'Area Hotel',
    manageHotel: 'Kelola profil hotel, pemesanan, dan riwayat tamu Anda',
    profile: 'Profil',
    rooms: 'Kamar',
    bookings: 'Pemesanan',
    calendar: 'Kalender',
    recordStay: 'Catat Menginap',
    subscription: 'Langganan',
    bookingRequests: 'Permintaan Pemesanan',
    manageRequests: 'Kelola permintaan pemesanan masuk untuk hotel Anda',
    noPendingBookings: 'Tidak ada permintaan pemesanan yang menunggu saat ini.',
    noBookings: 'Tidak ada permintaan pemesanan saat ini.',
    confirmBooking: 'Konfirmasi',
    rejectBooking: 'Tolak',
    confirming: 'Mengonfirmasi...',
    rejecting: 'Menolak...',
    bookingConfirmed: 'Pemesanan berhasil dikonfirmasi',
    bookingRejected: 'Pemesanan ditolak',
    rejectConfirm: 'Apakah Anda yakin ingin menolak pemesanan ini?',
    filterByStatus: 'Filter berdasarkan Status',
    roomInventory: 'Inventaris Kamar',
    manageRooms: 'Kelola tipe kamar dan harga hotel Anda',
    addRoom: 'Tambah Kamar',
    noRoomsYet: 'Belum ada kamar ditambahkan',
    addFirstRoom: 'Mulai dengan menambahkan tipe kamar pertama Anda dengan foto dan harga',
    addYourFirstRoom: 'Tambahkan Kamar Pertama Anda',
    createRoom: 'Buat Kamar Baru',
    editRoom: 'Edit Kamar',
    updateRoomDetails: 'Perbarui detail dan foto kamar',
    addNewRoom: 'Tambahkan tipe kamar baru dengan foto dan harga',
    roomTypeName: 'Tipe / Nama Kamar',
    roomTypePlaceholder: 'mis., Suite Deluxe, Kamar Standar',
    pricePerNight: 'Harga per Malam',
    currency: 'Mata Uang',
    selectCurrency: 'Pilih mata uang',
    enterPrice: 'Masukkan harga',
    promoText: 'Teks Promo (Opsional)',
    promoPlaceholder: 'mis., Diskon 20% untuk pemesanan awal',
    roomPhotos: 'Foto Kamar',
    uploadImages: 'Unggah gambar (maks 2MB per gambar). Anda dapat menambahkan beberapa foto.',
    roomTypeCannotChange: 'Tipe kamar tidak dapat diubah saat mengedit',
    createRoomBtn: 'Buat Kamar',
    updateRoomBtn: 'Perbarui Kamar',
    creating: 'Membuat...',
    updating: 'Memperbarui...',
    roomCreated: 'Kamar berhasil dibuat',
    roomUpdated: 'Kamar berhasil diperbarui',
    roomDeleted: 'Kamar berhasil dihapus',
    deleteRoomConfirm: 'Apakah Anda yakin ingin menghapus kamar',
    paymentInstructionsForm: 'Instruksi Pembayaran untuk Tamu',
    paymentInstructionsDesc: 'Konfigurasikan instruksi pembayaran yang akan ditampilkan kepada tamu setelah mereka mengirimkan permintaan pemesanan',
    paymentInstructionsPlaceholder: 'Masukkan instruksi pembayaran (rekening bank, metode pembayaran, dll.)',
    paymentInstructionsSaved: 'Instruksi pembayaran berhasil disimpan',
    availability: 'Kalender Ketersediaan',
    viewAvailability: 'Lihat kalender pemesanan dan ketersediaan kamar',
    filterByRoom: 'Filter berdasarkan Tipe Kamar',
    allRooms: 'Semua Kamar',
    noBookingsInPeriod: 'Tidak ada pemesanan dalam periode ini',
    loadingAvailability: 'Memuat ketersediaan...',
  },
  account: {
    guestAccount: 'Akun Tamu',
    manageAccount: 'Kelola profil, pemesanan, dan riwayat menginap Anda',
    profile: 'Profil',
    bookings: 'Pemesanan',
    stayHistory: 'Riwayat Menginap',
  },
  currency: {
    IDR: 'Rupiah Indonesia (IDR)',
    USD: 'Dolar AS (USD)',
    EUR: 'Euro (EUR)',
    SGD: 'Dolar Singapura (SGD)',
  },
};

const translations: Record<Language, TranslationDictionary> = {
  en,
  id,
};

export function getStoredLanguage(): Language {
  const stored = localStorage.getItem(STORAGE_KEY);
  return (stored === 'id' || stored === 'en') ? stored : 'en';
}

export function setStoredLanguage(lang: Language): void {
  localStorage.setItem(STORAGE_KEY, lang);
}

export function translate(lang: Language, key: string): string {
  const keys = key.split('.');
  let value: string | TranslationDictionary = translations[lang];
  
  for (const k of keys) {
    if (typeof value === 'object' && k in value) {
      value = value[k];
    } else {
      // Fallback to English if key not found
      value = translations.en;
      for (const fallbackKey of keys) {
        if (typeof value === 'object' && fallbackKey in value) {
          value = value[fallbackKey];
        } else {
          return key; // Return key if not found in fallback
        }
      }
      break;
    }
  }
  
  return typeof value === 'string' ? value : key;
}
